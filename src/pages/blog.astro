---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Obtener todos los posts
const allPosts = await getCollection('posts');

// Ordenar por fecha de publicación (más reciente primero)
allPosts.sort((a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf());
---

<Layout>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <nav class="flex gap-6 mb-8">
      <a href="/" class="text-purple-700 hover:text-purple-900 font-medium">Inicio</a>
      <a href="/about/" class="text-purple-700 hover:text-purple-900 font-medium">Sobre mi</a>
      <a href="/blog/" class="text-purple-700 hover:text-purple-900 font-medium">Blog</a>
    </nav>
    
    <div class="bg-white rounded-lg shadow-md p-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-4">Mi blog de aprendizaje Astro</h1>
      <p class="text-gray-700 mb-8">Aquí es donde publicaré sobre mi viaje de aprendizaje Astro.</p>
      
      {allPosts.length > 0 ? (
        <ul class="space-y-6">
          {allPosts.map(post => (
            <li class="border-b border-gray-200 pb-6 last:border-0 last:pb-0">
              <a href={`/posts/${post.slug}`} class="block group">
                <div class="flex flex-col md:flex-row gap-4">
                  {post.data.image && (
                    <div class="md:w-1/3">
                      <img 
                        src={post.data.image.url} 
                        alt={post.data.image.alt} 
                        class="w-full h-48 object-cover rounded-lg"
                      />
                    </div>
                  )}
                  <div class={post.data.image ? "md:w-2/3" : "w-full"}>
                    <h2 class="text-xl font-semibold text-purple-700 group-hover:underline mb-2">
                      {post.data.title}
                    </h2>
                    <p class="text-sm text-gray-500 mb-2">
                      {new Date(post.data.pubDate).toLocaleDateString('es-ES')}
                      {post.data.author && (
                        <span> · Por <a href={`/autores/${post.data.author}`} class="hover:underline">
                          {post.data.author.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                        </a></span>
                      )}
                    </p>
                    <p class="text-gray-700">{post.data.description}</p>
                    
                    {post.data.tags && post.data.tags.length > 0 && (
                      <div class="flex flex-wrap gap-2 mt-3">
                        {post.data.tags.map(tag => (
                          <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">
                            #{tag}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </a>
            </li>
          ))}
        </ul>
      ) : (
        <p class="text-gray-600 italic">No hay posts disponibles todavía. ¡Vuelve pronto!</p>
      )}
    </div>
  </div>
</Layout>